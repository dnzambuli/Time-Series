---
title: "subtask 3"
author: "Nzambuli Daniel"
date: "2024-06-10"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Question

A manager of a national park collected data on the number of visitors (in thousands) who visited the park in each quarter of 2021 and 2022. The data includes:

|  season  | Seasonal index | 2021 | 2022 |
|:--------:|:---------------|:-----|:-----|
|  summer  | 162            | 51   | 54   |
| moonsoon | 62             | 28   | 32   |
|  winter  | 87             | 41   | 45   |
|  spring  | 89             | 36   | 43   |

## Tasks:

### 1. Calculate the deseasonalized values for each quarter.

$$
seasonal\ index = \frac{real\ value}{cMA} * 100
$$

```{r}
data = data.frame(season = c("summer", "monsoon", "winter", "spring"),
                  visit_2021 = c(51, 28, 41, 36),
                  visit_2022 = c(54, 32, 45, 43),
                  seas_ind = c(162, 62, 87, 89))

library(tidyr)
data_long = pivot_longer(data, cols = c(visit_2021, visit_2022) , values_to = "visitors", names_to = "year")
data_long
```

```{r}
library(dplyr)

data_long = data_long %>%
  mutate(year = sub("visit_", "", year))

data_long
```

#### Deaseasoned data

```{r}
data_long$desnd_data = data_long$visitors/data_long$seas_ind * 100

data_long
```

#### Order by Year

```{r}
data_long = data_long %>% arrange(year)

data_long
```

### 2. Compute the trend values for the deseasonalized data.

$$
\sum Y_{t} = n \beta_0 + \beta_1 \sum x_t\\
\sum x_t y_t = \beta_0\sum x_t + \beta_1 \sum x_t^2
$$

$t = seq\{1, n\}$

$x_t = 2 ( t - median(t))$

```{r}
data_long$t = seq(1, nrow(data_long))
med_t = median(data_long$t)
data_long$x_t = 2*(data_long$t - med_t)
data_long$des_x_t = data_long$desnd_data * data_long$x_t
data_long
```

$$
\frac{\sum y_t}{n} = \beta_0\\
\sum x_t y_t = \beta_1 \sum x_t^2
$$

```{r}
data_long$x_t_sqrd = data_long$x_t ^ 2
data_long
```

#### Find $\beta_0$ and $\beta_1$

```{r}
n = nrow(data_long)
beta_0 = sum(data_long$desnd_data) / n
beta_1 = sum(data_long$des_x_t) / sum(data_long$x_t_sqrd)
 
cat("beta 0 and beta 1:\n",beta_0, "\t", beta_1 )
```

#### trend values

```{r}
data_long$trend = beta_0 + beta_1 * data_long$x_t

data_long
```

### 3. Plot the quarterly number of visitors for 2021 and 2022, along with the deseasonalized values and trend values on the same graph.

```{r}
data_long$x = rep(seq(1,4), 2)

library(ggplot2)

ggplot(data_long, aes(x = interaction(season, year), group = 1))+
  geom_line(aes(y = desnd_data, color = "deseasoned"))+
  geom_line(aes(y = trend, color = "trend"), linetype = "dashed")+
  geom_line(aes(y = visitors, color = "visitors"))+
  labs(
    title = "quarterly number of visitors for 2021 and 2022",
    y = "visitors",
    x = "seasons"
  )+
  scale_color_manual(name = "Legend", values = c("deseasoned" = "blue", "trend" = "red","visitors" = "green")) +
  theme_minimal()
```

#### Trend lines are smooth lines because they are generated by

$$
trend = 43.654 + 0.93 X_t
$$

This is the equation of a straight line with an intercept at `43.654`

```{r}
ggplot(data_long, aes(x = t, group = 1))+
  geom_line(aes(y = desnd_data, color = "deseasoned"))+
  geom_line(aes(y = trend, color = "trend"), linetype = "dashed")+
  geom_line(aes(y = visitors, color = "visitors"))+
  labs(
    title = "quarterly number of visitors for 2021 and 2022",
    y = "visitors",
    x = "seasons"
  )+
  scale_color_manual(name = "Legend", values = c("deseasoned" = "blue", "trend" = "red","visitors" = "green")) +
  theme_minimal()
```

**Interpretation**

1.  Summer has the highest number of visitors with monsoon having the least number of visitors
2.  The deseasonalized graph represents data without the effect periodic fluctuation like holidays and the prevailing weather.
    1.  The data in the second plot is 1 -\> summer , 2 -\> monsoon, 3 -\> winter, 4 -\> spring
    2.  The **summer** predictions tend to be **lower** than anticipated indicating an overall increase in the number of visitors than expected
    3.  The **winter and monsoon** have the highest predictions than the actual visitors indicating less than predicted visitors.
3.  The `overall` trend is that the number of visitors are increasing as time goes by. This can be augmented by presenting sites that visitors can go to during winter and monsoon season to help reflect the predicted values and increase the total visitors over time

The initial trend-line may not be accurate as the analysis starts in summer however the graph indicates the monsoon season is the initial season for the region.

The graph may however indicate when interventions may be implemented to facilitate maximum visitation.

### Cyclic trend

```{r}
data_long$cyclic = data_long$desnd_data/ data_long$visitors
data_long
```

#### Plot

```{r}
ggplot(data_long, aes(x = t, group = 1))+
  geom_line(aes(y = desnd_data, color = "deseasoned"))+
  geom_line(aes(y = trend, color = "trend"), linetype = "dashed")+
  geom_line(aes(y = visitors, color = "visitors"))+
  geom_line(aes(y = cyclic, color = "cyclic"))+
  labs(
    title = "quarterly number of visitors for 2021 and 2022",
    y = "visitors",
    x = "seasons"
  )+
  scale_color_manual(name = "Legend", values = c("deseasoned" = "blue", "trend" = "red","visitors" = "green", "cyclic" = "orange")) +
  theme_minimal()
```
